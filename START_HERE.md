# 👋 欢迎接手这个项目！

你好，新同事！我是上一任开发者。很高兴能把这个项目交到你手上。这是一个运维工作流管理平台，目前已经完成了基础架构和大部分核心功能，但还有一个关键问题需要你来解决。

---

## 🚀 第一步：快速启动（10 分钟）

### 1. 安装依赖
```bash
npm install
```

### 2. 配置环境变量
找前任开发者或团队负责人获取 Supabase 凭证，然后创建 `.env` 文件：

```env
VITE_SUPABASE_URL=https://xxxxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

参考 `.env.example` 文件。

### 3. 启动项目
```bash
npm run dev
```

浏览器打开 http://localhost:5173，你应该能看到登录页面。

### 4. 创建测试账号
点击"注册"，随便输入一个邮箱和密码（无需真实邮箱），登录进去看看。

---

## 📚 第二步：阅读文档（30 分钟）

建议按以下顺序阅读：

### 1️⃣ QUICKSTART.md（5 分钟）
快速了解项目结构和基本操作。

### 2️⃣ HANDOVER.md（15 分钟）
这是最重要的文档！包含：
- 项目背景和目标
- 当前完成了什么
- **存在什么问题**（重点）
- 下一步怎么推进

### 3️⃣ ISSUES.md（10 分钟）
重点看 **Issue #1: X6 编辑器白屏问题**
- 这是当前最紧急的问题
- 我已经写了详细的调试步骤和 3 个修复方案
- 你的首要任务就是解决它

---

## 🎯 第三步：理解当前状态（15 分钟）

### 已经完成的功能
- ✅ 用户登录注册（Supabase Auth）
- ✅ 场景管理（创建、编辑、删除）
- ✅ SOP 文档编辑器（Markdown + 图片上传）
- ✅ 工作流列表页面
- ✅ 数据库完整架构（所有迁移已应用）

### 当前最大的问题
**X6 编辑器白屏**

试试这个操作：
1. 登录后进入"场景管理"
2. 创建或打开一个场景
3. 点击"流程图"标签页
4. **问题出现**：应该显示流程图编辑器，但是白屏

打开控制台（F12），你会看到：
```
⚠ X6Editor container has no size (attempt 1/10) {width: 0, height: 0}
```

### 为什么会白屏？
X6 图形库需要一个有明确尺寸的容器才能初始化画布，但容器的高度现在是 0。问题出在 CSS 布局层级传递上。

---

## 🔧 第四步：开始修复（1-2 天）

### 推荐修复路径

#### 方案 A：快速修复（30 分钟）
最简单直接，用固定高度：

打开 `src/pages/ScenarioDetailPage.tsx`，找到第 350 行左右：

```typescript
{activeTab === 'flowchart' && (
  <div className="h-full w-full">  // 这里有问题
    <X6Editor ... />
  </div>
)}
```

改成：

```typescript
{activeTab === 'flowchart' && (
  <div style={{ width: '100%', height: 'calc(100vh - 200px)', minHeight: '500px' }}>
    <X6Editor ... />
  </div>
)}
```

保存，刷新页面，看看是否显示画布。

#### 方案 B：优雅的解决方案（2 小时）
使用 ResizeObserver 监听容器尺寸变化，详见 `ISSUES.md` 的方案 B。

#### 方案 C：根本解决方案（半天）
修复整个布局链的高度传递，详见 `ISSUES.md` 的方案 C。

### 调试技巧
```javascript
// 在浏览器控制台执行，检查每一层的高度：
document.querySelectorAll('main, .flex-1, .x6-editor-container, .x6-graph-container')
  .forEach(el => {
    console.log(el.className, el.getBoundingClientRect().height)
  })
```

找到第一个高度为 0 的元素，那就是问题所在。

---

## 🎉 第五步：验收和继续（后续）

### 验收标准
修复完成后，应该能做到：
- [ ] 打开"流程图"标签页，立即看到画布（带网格背景）
- [ ] 左侧工具栏可以点击添加节点
- [ ] 节点可以拖拽到画布上
- [ ] 节点之间可以连线
- [ ] 点击"保存"后数据写入数据库
- [ ] 刷新页面后，流程图正确加载

### 下一步任务（按优先级）

**P1 - 高优先级（3-5 天）**：
1. 完善场景和工作流的关联功能（用户可以为场景选择工作流）
2. 完善工作流编辑页面（复用 X6Editor 组件）
3. 添加基本的数据验证

**P2 - 中优先级（1-2 周）**：
1. 实现工作流执行引擎（用 Supabase Edge Function）
2. 实现执行日志实时刷新
3. 添加常用的工作流节点类型（任务、决策、延迟等）

详细的任务清单和实现建议，全部都在 `ISSUES.md` 里。

---

## 🆘 遇到问题怎么办？

### 1. 查看文档
- `ISSUES.md` - 已知问题和详细修复方案
- `DATABASE.md` - 数据库操作参考
- `DEVELOPMENT.md` - 代码规范和最佳实践

### 2. 常见问题
- **编译错误**：删除 `node_modules`，重新 `npm install`
- **页面白屏**：F12 查看控制台错误
- **数据库连接失败**：检查 `.env` 配置
- **Supabase 权限问题**：确认已被邀请到项目

### 3. 调试技巧
```typescript
// 在代码中加日志
console.log('Loading scenario:', scenarioId)
console.log('Supabase response:', { data, error })

// 使用 React DevTools 查看组件状态
// 使用 Chrome Network 标签查看请求
// 在 Supabase Dashboard 直接查看数据库数据
```

---

## 💡 一些建议

### 关于代码质量
- 这个项目已经有基本的架构和规范，请遵循现有代码风格
- TypeScript 类型要写全，避免用 `any`
- 数据库操作务必处理错误，用户体验很重要

### 关于开发节奏
- 先解决 P0 问题（X6 编辑器），再推进其他功能
- 每完成一个功能，测试一下基本流程
- 遇到问题及时更新 `ISSUES.md`

### 关于数据安全
- **永远不要**用 `DROP TABLE` 或大范围 `DELETE`
- 所有表都有 RLS 保护，不要绕过它
- 敏感信息不要硬编码，用环境变量

---

## 📊 项目整体进度

```
[████████████░░░░░░░░] 60% 完成

✅ 已完成：
- 项目架构搭建
- 用户认证
- 数据库设计和迁移
- 场景管理基础功能
- SOP 文档编辑器

🔧 进行中：
- X6 流程图编辑器（你的首要任务）

⏳ 待开发：
- 场景工作流关联
- 工作流编辑功能
- 工作流执行引擎
- 定时任务和通知
```

---

## 🎯 总结：你的行动路径

1. **今天**：
   - 启动项目 ✅
   - 阅读 HANDOVER.md 和 ISSUES.md ✅
   - 理解 X6 编辑器白屏问题 ✅

2. **明天**：
   - 尝试方案 A 快速修复 ✅
   - 如果成功，优化为方案 B 或 C ✅
   - 验证所有功能正常 ✅

3. **接下来几天**：
   - 实现场景工作流关联 ✅
   - 完善工作流编辑页面 ✅
   - 逐步推进其他 P1/P2 任务 ✅

---

## 最后的话

这个项目的基础架构已经比较稳固了，数据库设计也考虑得比较完整。X6 编辑器的白屏问题看起来棘手，但其实就是一个 CSS 布局问题，按照我提供的方案应该能很快解决。

我已经尽可能详细地记录了所有信息：
- 项目背景和状态
- 详细的问题分析和修复方案
- 完整的代码示例
- 后续的开发路线图

相信你能顺利接手并推进这个项目。加油！💪

如果有任何疑问，随时查阅文档或联系前任开发者（如果可以的话）。

---

**前任开发者留**
2026-01-16

---

P.S. 修复 X6 编辑器后，记得更新 `ISSUES.md` 中 Issue #1 的状态，这样后续维护的同事能知道问题已解决。

祝顺利！🚀
