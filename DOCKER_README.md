# OPS Workflow Center - Docker éƒ¨ç½²

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²

é€‚ç”¨äº CentOS 7 åŠä»¥ä¸Šç‰ˆæœ¬çš„ä¸€é”® Docker éƒ¨ç½²æ–¹æ¡ˆã€‚

---

## ğŸ“‹ éƒ¨ç½²æµç¨‹

### 1ï¸âƒ£ æœ¬åœ°æ‰“åŒ…

```bash
bash pack-for-deploy.sh
```

ç”Ÿæˆéƒ¨ç½²åŒ…ï¼š`ops-workflow-center-YYYYMMDD-HHMMSS.tar.gz`

### 2ï¸âƒ£ ä¸Šä¼ æœåŠ¡å™¨

```bash
scp ops-workflow-center-*.tar.gz root@æœåŠ¡å™¨IP:/opt/
```

### 3ï¸âƒ£ è§£å‹é…ç½®

```bash
cd /opt
tar -xzf ops-workflow-center-*.tar.gz
cd ops-workflow-center

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
vi .env  # å¡«å…¥ Supabase é…ç½®
```

### 4ï¸âƒ£ ä¸€é”®éƒ¨ç½²

```bash
sudo bash docker-deploy.sh
```

### 5ï¸âƒ£ é…ç½®é˜²ç«å¢™

```bash
sudo firewall-cmd --permanent --add-port=5173/tcp
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --reload
```

### 6ï¸âƒ£ è®¿é—®åº”ç”¨

- å‰ç«¯: `http://æœåŠ¡å™¨IP:5173`
- åç«¯: `http://æœåŠ¡å™¨IP:3000`

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | è¯´æ˜ | é€‚åˆäººç¾¤ |
|------|------|---------|
| **éƒ¨ç½²æ“ä½œæ‰‹å†Œ.md** | è¯¦ç»†çš„åˆ†æ­¥éª¤æ“ä½œæŒ‡å— | æ–°æ‰‹ï¼Œè·Ÿç€åš |
| **DOCKER_QUICKSTART.md** | å¿«é€Ÿå‚è€ƒå’Œå‘½ä»¤é€ŸæŸ¥è¡¨ | æœ‰ç»éªŒçš„ç”¨æˆ· |
| **DOCKER_DEPLOYMENT.md** | å®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£ | è¿ç»´äººå‘˜ |
| **DEPLOYMENT_OPTIONS.md** | å„ç§éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯” | æ–¹æ¡ˆé€‰æ‹© |

---

## ğŸ¯ æ ¸å¿ƒæ–‡ä»¶

```
ops-workflow-center/
â”œâ”€â”€ docker-deploy.sh         # ä¸€é”®éƒ¨ç½²è„šæœ¬ â­
â”œâ”€â”€ pack-for-deploy.sh       # æ‰“åŒ…è„šæœ¬ â­
â”œâ”€â”€ Dockerfile               # Docker é•œåƒé…ç½®
â”œâ”€â”€ docker-compose.yml       # Docker ç¼–æ’é…ç½®
â”œâ”€â”€ .env                     # ç¯å¢ƒå˜é‡ï¼ˆéœ€é…ç½®ï¼‰â­
â””â”€â”€ ecosystem.config.cjs     # PM2 è¿›ç¨‹ç®¡ç†
```

---

## âš¡ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æ—¥å¿—
sudo docker-compose logs -f

# é‡å¯æœåŠ¡
sudo docker-compose restart

# åœæ­¢æœåŠ¡
sudo docker-compose down

# å¯åŠ¨æœåŠ¡
sudo docker-compose up -d

# æŸ¥çœ‹çŠ¶æ€
sudo docker-compose ps
```

---

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

`.env` æ–‡ä»¶å¿…éœ€é…ç½®ï¼š

```bash
VITE_SUPABASE_URL=https://xxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## ğŸ’¡ ä¸ºä»€ä¹ˆé€‰æ‹© Dockerï¼Ÿ

- âœ… **é›¶ç³»ç»Ÿæ”¹åŠ¨** - ä¸å½±å“ç°æœ‰ç¯å¢ƒ
- âœ… **ä¸€é”®éƒ¨ç½²** - 5åˆ†é’Ÿå®Œæˆéƒ¨ç½²
- âœ… **ç¯å¢ƒéš”ç¦»** - å®Œå…¨ç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒ
- âœ… **æ˜“äºç»´æŠ¤** - ç®€å•çš„å‘½ä»¤ç®¡ç†æœåŠ¡
- âœ… **ç”Ÿäº§çº§æ–¹æ¡ˆ** - å¤§å‚æ ‡å‡†éƒ¨ç½²æ–¹å¼
- âœ… **å®Œç¾æ”¯æŒ Playwright** - å†…ç½®æµè§ˆå™¨ç¯å¢ƒ

---

## âš ï¸ ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: CentOS 7+, Rocky Linux 8+, Ubuntu 20.04+
- **å†…å­˜**: æœ€å°‘ 2GB
- **ç£ç›˜**: æœ€å°‘ 10GB å¯ç”¨ç©ºé—´
- **æƒé™**: root æˆ– sudo æƒé™

---

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

### å¿«é€Ÿè¯Šæ–­

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
sudo docker-compose ps

# 2. æŸ¥çœ‹æ—¥å¿—
sudo docker-compose logs

# 3. æ£€æŸ¥ç¯å¢ƒé…ç½®
cat .env

# 4. æ£€æŸ¥ç«¯å£
sudo netstat -tulpn | grep 5173
sudo netstat -tulpn | grep 3000
```

### å¸¸è§é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| å®¹å™¨æ— æ³•å¯åŠ¨ | æŸ¥çœ‹æ—¥å¿—: `sudo docker-compose logs` |
| æ— æ³•è®¿é—®æœåŠ¡ | æ£€æŸ¥é˜²ç«å¢™å’Œå®‰å…¨ç»„é…ç½® |
| ç«¯å£è¢«å ç”¨ | ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£ |
| æ„å»ºå¤±è´¥ | æ‰§è¡Œ: `sudo docker-compose build --no-cache` |

è¯¦ç»†æ’æŸ¥æ­¥éª¤è¯·æŸ¥çœ‹ **éƒ¨ç½²æ“ä½œæ‰‹å†Œ.md**

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

```bash
# 1. åœæ­¢æœåŠ¡
sudo docker-compose down

# 2. å¤‡ä»½æ•°æ®
cp -r logs logs.backup
cp -r uploads uploads.backup

# 3. ä¸Šä¼ æ–°ä»£ç å¹¶è§£å‹
# ...

# 4. æ¢å¤æ•°æ®å’Œé…ç½®
cp .env.backup .env
cp -r logs.backup logs
cp -r uploads.backup uploads

# 5. é‡æ–°æ„å»ºå¯åŠ¨
sudo docker-compose build
sudo docker-compose up -d
```

---

## ğŸ“Š æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Docker Container                â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Frontend   â”‚  â”‚   Backend   â”‚ â”‚
â”‚  â”‚   (Vite)     â”‚  â”‚   (Node.js) â”‚ â”‚
â”‚  â”‚   :5173      â”‚  â”‚   :3000     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Playwright Service         â”‚  â”‚
â”‚  â”‚   (Browser Automation)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    Supabase    â”‚
     â”‚   (Database)   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### èµ„æºé™åˆ¶ï¼ˆå¯é€‰ï¼‰

ç¼–è¾‘ `docker-compose.yml` æ·»åŠ ï¼š

```yaml
deploy:
  resources:
    limits:
      cpus: '2'
      memory: 2G
```

### æ—¥å¿—è½®è½¬

```bash
# æ¸…ç† 7 å¤©å‰çš„æ—¥å¿—
find logs/ -name "*.log" -mtime +7 -delete
```

---

## ğŸ” å®‰å…¨å»ºè®®

1. ä¿®æ”¹é»˜è®¤ç«¯å£ï¼ˆç¼–è¾‘ `docker-compose.yml`ï¼‰
2. é…ç½® Nginx åå‘ä»£ç†
3. å¯ç”¨ HTTPS (Let's Encrypt)
4. é™åˆ¶è®¿é—® IPï¼ˆé˜²ç«å¢™è§„åˆ™ï¼‰
5. å®šæœŸå¤‡ä»½æ•°æ®

---

## ğŸ“¦ æ•°æ®æŒä¹…åŒ–

ä»¥ä¸‹ç›®å½•ä¼šè‡ªåŠ¨æŒ‚è½½åˆ°å®¿ä¸»æœºï¼š

- `./logs/` - åº”ç”¨æ—¥å¿—
- `./uploads/` - ä¸Šä¼ æ–‡ä»¶

å³ä½¿åˆ é™¤å®¹å™¨ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

---

## ğŸ“ å­¦ä¹ èµ„æº

- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Docker Compose æ–‡æ¡£](https://docs.docker.com/compose/)
- [Supabase æ–‡æ¡£](https://supabase.com/docs)

---

## âœ… éƒ¨ç½²åæ£€æŸ¥

- [ ] å‰ç«¯å¯è®¿é—® (`http://æœåŠ¡å™¨IP:5173`)
- [ ] åç«¯å¯è®¿é—® (`http://æœåŠ¡å™¨IP:3000`)
- [ ] å¯ä»¥æ³¨å†Œç™»å½•
- [ ] é˜²ç«å¢™å·²é…ç½®
- [ ] æ—¥å¿—æ­£å¸¸è¾“å‡º
- [ ] å®¹å™¨è‡ªåŠ¨é‡å¯å·²å¯ç”¨

---

## ğŸ“ è·å–å¸®åŠ©

1. æŸ¥çœ‹ **éƒ¨ç½²æ“ä½œæ‰‹å†Œ.md** - è¯¦ç»†æ­¥éª¤æŒ‡å—
2. æŸ¥çœ‹ **DOCKER_DEPLOYMENT.md** - å®Œæ•´æŠ€æœ¯æ–‡æ¡£
3. æ£€æŸ¥æ—¥å¿—: `sudo docker-compose logs -f`

---

**å¼€å§‹éƒ¨ç½²**ï¼šæŸ¥çœ‹ **éƒ¨ç½²æ“ä½œæ‰‹å†Œ.md**

**å¿«é€Ÿå‚è€ƒ**ï¼šæŸ¥çœ‹ **DOCKER_QUICKSTART.md**

---

æ›´æ–°æ—¶é—´: 2024-01-18

ç‰ˆæœ¬: v1.0.0
